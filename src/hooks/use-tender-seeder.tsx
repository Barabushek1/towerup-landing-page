
import { useEffect } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useQuery } from '@tanstack/react-query';

interface TenderSeedItem {
  title: string;
  description: string;
  requirements: string;
  category: string;
  deadline: string;
  documents: string[] | null;
  status: string;
}

export function useTenderSeeder() {
  const { data: existingTenders } = useQuery({
    queryKey: ['tenders-count'],
    queryFn: async () => {
      const { count, error } = await supabase
        .from('tenders')
        .select('*', { count: 'exact', head: true });

      if (error) {
        console.error('Error checking tenders count:', error);
        return 0;
      }

      return count || 0;
    },
  });

  useEffect(() => {
    const seedTenders = async () => {
      // Only seed if there are no tenders
      if (existingTenders !== undefined && existingTenders === 0) {
        console.log('Seeding tenders...');
        const sampleTenders: TenderSeedItem[] = [
          {
            title: 'Поставка строительных материалов для жилого комплекса',
            description: 'Компания TOWERUP объявляет тендер на поставку строительных материалов для нового жилого комплекса в г. Ташкент. Требуются высококачественные материалы, соответствующие международным стандартам.\n\nКоличество и спецификация материалов указаны в прикрепленных документах. Поставка должна осуществляться по графику строительства в течение 12 месяцев.\n\nПриоритет отдается поставщикам с опытом работы с крупными строительными проектами.',
            requirements: '1. Опыт работы на рынке не менее 3 лет\n2. Наличие всех необходимых сертификатов качества\n3. Возможность осуществлять регулярные поставки по графику\n4. Наличие собственного транспорта для доставки материалов\n5. Предоставление гарантии на поставляемые материалы',
            category: 'Строительные материалы',
            deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'active'
          },
          {
            title: 'Услуги по монтажу инженерных систем',
            description: 'Тендер на выполнение работ по монтажу систем отопления, вентиляции и кондиционирования в офисном здании класса А+. Общая площадь здания - 12,000 кв.м.\n\nРаботы включают в себя проектирование, поставку оборудования, монтаж и пусконаладку всех инженерных систем. Срок выполнения работ - 6 месяцев с момента подписания договора.',
            requirements: '1. Опыт выполнения аналогичных работ на объектах площадью от 5,000 кв.м\n2. Наличие всех необходимых лицензий и разрешений\n3. Наличие квалифицированного инженерного персонала\n4. Возможность предоставить банковскую гарантию на выполнение работ\n5. Соблюдение стандартов ASHRAE и местных строительных норм',
            category: 'Инженерные системы',
            deadline: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'active'
          },
          {
            title: 'Закупка мебели для бизнес-центра',
            description: 'Компания TOWERUP приглашает производителей и поставщиков офисной мебели принять участие в тендере на поставку мебели для нового бизнес-центра.\n\nТребуется комплексное оснащение рабочих мест (столы, кресла, шкафы), зон отдыха и переговорных комнат. Общее количество рабочих мест - 350.',
            requirements: '1. Наличие собственного производства или официального представительства производителя\n2. Возможность изготовления мебели по индивидуальным размерам\n3. Соответствие мебели эргономическим стандартам\n4. Срок производства и поставки не более 2 месяцев\n5. Предоставление гарантии не менее 3 лет',
            category: 'Мебель и оборудование',
            deadline: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'active'
          },
          {
            title: 'Услуги по ландшафтному дизайну',
            description: 'Тендер на разработку проекта и выполнение работ по ландшафтному дизайну территории жилого комплекса. Площадь территории - 1.5 га.\n\nРаботы включают проектирование зон отдыха, детских площадок, спортивных зон, озеленение, организацию пешеходных дорожек, установку малых архитектурных форм.\n\nПриветствуются инновационные решения с применением современных технологий и экологических подходов.',
            requirements: '1. Портфолио реализованных проектов ландшафтного дизайна\n2. Наличие в штате ландшафтных архитекторов и дендрологов\n3. Опыт работы с жилыми комплексами премиум-класса\n4. Возможность осуществления последующего обслуживания территории\n5. Использование преимущественно местных растений, адаптированных к климатическим условиям',
            category: 'Ландшафтный дизайн',
            deadline: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'active'
          },
          {
            title: 'Монтаж систем безопасности и видеонаблюдения',
            description: 'Компания TOWERUP объявляет тендер на установку комплексной системы безопасности для торгово-развлекательного центра. Площадь объекта - 25,000 кв.м.\n\nТребуется проектирование и монтаж систем видеонаблюдения, контроля доступа, охранной сигнализации, пожарной безопасности с выводом на единый пульт управления.\n\nПредпочтение отдается решениям с использованием технологий искусственного интеллекта и аналитики видеопотока.',
            requirements: '1. Лицензия на осуществление деятельности по монтажу систем безопасности\n2. Опыт работы с крупными коммерческими объектами\n3. Сертификация специалистов по системам безопасности ведущих производителей\n4. Возможность интеграции с существующими системами заказчика\n5. Обеспечение технической поддержки 24/7 и гарантийного обслуживания',
            category: 'Системы безопасности',
            deadline: new Date(Date.now() + 18 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'active'
          },
          {
            title: 'Разработка и внедрение системы управления зданием (BMS)',
            description: 'Тендер на разработку, поставку и внедрение автоматизированной системы управления зданием для нового офисно-гостиничного комплекса.\n\nCистема должна обеспечивать централизованное управление всеми инженерными системами: отопление, вентиляция, кондиционирование, электроснабжение, освещение, лифты, системы безопасности.\n\nОсобое внимание уделяется энергоэффективности и возможности удаленного мониторинга и управления.',
            requirements: '1. Опыт внедрения BMS на объектах смешанного назначения\n2. Наличие сертифицированных специалистов по системам автоматизации зданий\n3. Предоставление детальной документации и обучение персонала заказчика\n4. Интеграция с облачными решениями и мобильными приложениями\n5. Масштабируемость системы с возможностью дальнейшего расширения',
            category: 'Автоматизация зданий',
            deadline: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'closed'
          },
          {
            title: 'Услуги по клининговому обслуживанию объектов',
            description: 'Компания TOWERUP приглашает клининговые компании к участию в тендере на предоставление регулярных услуг по уборке и обслуживанию офисных и жилых помещений.\n\nОбщая площадь обслуживаемых объектов - около 45,000 кв.м. Требуется ежедневная уборка мест общего пользования, периодическая генеральная уборка, уборка прилегающих территорий, сезонные работы.\n\nДоговор заключается на 3 года с возможностью пролонгации.',
            requirements: '1. Наличие собственного штата обученного персонала\n2. Использование профессионального оборудования и сертифицированных чистящих средств\n3. Опыт обслуживания объектов премиум-класса\n4. Страхование ответственности перед третьими лицами\n5. Готовность работать в режиме 24/7, включая праздничные дни',
            category: 'Клининговые услуги',
            deadline: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
            documents: null,
            status: 'completed'
          }
        ];

        for (const tender of sampleTenders) {
          const { error } = await supabase
            .from('tenders')
            .insert(tender);

          if (error) {
            console.error('Error seeding tender:', error);
          }
        }

        console.log('Tenders seeded successfully');
      }
    };

    if (existingTenders !== undefined && existingTenders === 0) {
      seedTenders();
    }
  }, [existingTenders]);
}
