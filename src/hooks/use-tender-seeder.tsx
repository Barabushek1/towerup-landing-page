
import { useEffect } from 'react';
import { supabase } from '@/integrations/supabase/client';

export const useTenderSeeder = () => {
  useEffect(() => {
    const seedTenders = async () => {
      // Check if we already have tenders
      const { count, error: countError } = await supabase
        .from('tenders')
        .select('*', { count: 'exact', head: true });
      
      if (countError) {
        console.error('Error checking tender count:', countError);
        return;
      }
      
      // If we already have tenders, don't seed
      if (count && count > 0) {
        return;
      }
      
      console.log('Seeding tenders...');
      
      // Sample tenders data
      const tenders = [
        {
          title: 'Строительство офисного здания',
          description: 'Требуется подрядчик для строительства 5-этажного офисного здания. Общая площадь застройки 2500 кв.м. Необходимы компании с опытом строительства коммерческих зданий не менее 5 лет.',
          requirements: 'Опыт строительства коммерческой недвижимости от 5 лет\nНаличие собственной строительной техники\nШтат квалифицированных работников не менее 50 человек\nСоблюдение сроков строительства\nВозможность предоставления гарантии на выполненные работы',
          category: 'Строительство',
          status: 'active',
          deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 days from now
        },
        {
          title: 'Поставка строительных материалов',
          description: 'Закупка строительных материалов для жилого комплекса. Требуется поставка кирпича, бетона, арматуры и других строительных материалов согласно спецификации.',
          requirements: 'Наличие сертификатов качества на все материалы\nВозможность регулярных поставок крупных партий\nОпыт работы с крупными застройщиками\nГибкие условия оплаты\nСоблюдение сроков поставки',
          category: 'Материалы',
          status: 'active',
          deadline: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(), // 15 days from now
        },
        {
          title: 'Разработка проекта жилого комплекса',
          description: 'Требуется разработка архитектурного проекта жилого комплекса из 3 зданий высотой 12-15 этажей. Общая площадь застройки 5000 кв.м. Необходимо предусмотреть современные архитектурные решения, энергоэффективность и комфортную среду для жильцов.',
          requirements: 'Опыт проектирования жилых комплексов от 3 лет\nНаличие портфолио реализованных проектов\nЗнание современных тенденций в архитектуре\nСоблюдение норм и требований к жилым зданиям\nОпыт работы с BIM-моделированием',
          category: 'Проектирование',
          status: 'completed',
          deadline: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(), // 15 days ago (past date for completed)
        },
        {
          title: 'Установка систем безопасности',
          description: 'Требуется компания для установки комплексной системы безопасности в бизнес-центре. Система должна включать видеонаблюдение, контроль доступа, пожарную сигнализацию и систему оповещения.',
          requirements: 'Опыт установки систем безопасности в коммерческих объектах\nНаличие всех необходимых лицензий и сертификатов\nГарантийное и постгарантийное обслуживание\nИнтеграция с существующими системами здания\nОбучение персонала работе с системой',
          category: 'Инженерные системы',
          status: 'closed',
          deadline: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(), // 60 days ago
        },
        {
          title: 'Благоустройство территории ЖК',
          description: 'Требуется подрядчик для благоустройства территории жилого комплекса. Работы включают озеленение, укладку тротуарной плитки, установку малых архитектурных форм, обустройство детских и спортивных площадок.',
          requirements: 'Опыт благоустройства территорий жилых комплексов\nНаличие портфолио выполненных работ\nОбеспечение высокого качества используемых материалов\nВозможность реализации ландшафтного дизайн-проекта\nСоблюдение экологических норм и требований',
          category: 'Благоустройство',
          status: 'active',
          deadline: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000).toISOString(), // 45 days from now
        },
      ];
      
      // Insert tenders
      const { error } = await supabase
        .from('tenders')
        .insert(tenders);
        
      if (error) {
        console.error('Error seeding tenders:', error);
      } else {
        console.log('Tenders seeded successfully');
      }
    };
    
    seedTenders();
  }, []);
};
